<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HomeCareAI ‚Äî Smart Home Event Analyzer</title>
  <style>
    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0078D7;
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 1.6rem;
      font-weight: bold;
      letter-spacing: 0.5px;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    section {
      margin-bottom: 2rem;
    }
    h2 {
      color: #0078D7;
      margin-bottom: 0.5rem;
    }
    input, select, button {
      padding: 0.5rem;
      margin-top: 0.5rem;
      font-size: 1rem;
    }
    button {
      cursor: pointer;
      background-color: #0078D7;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.6rem 1.2rem;
    }
    button:hover {
      background-color: #005fa3;
    }
    pre {
      background: #f1f1f1;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
    }
    img, video {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
    .notification {
      background: #fef9c3;
      border-left: 4px solid #facc15;
      padding: 0.5rem 1rem;
      margin-top: 0.5rem;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <header>üè† HomeCareAI ‚Äî Smart Home Event Analyzer</header>
  <main>
    
    <section id="demo-section">
      <h2>üé¨ Demo Scenarios</h2>
      <p>Select a predefined scenario to preview and analyze instantly.</p>
      <select id="demoSelect">
        <option value="">-- Select a demo asset --</option>
        <option value="stranger.png">üö™ Stranger Detected (Image)</option>
        <option value="stranger.mp4">üö∂ Stranger Arriving (Video)</option>
        <option value="fire-kitchen.mp4">üî• Fire in Kitchen (Video)</option>
        <option value="fire-at-kitchen.png">üî• Fire in Kitchen (Image)</option>
        <option value="falldetected1.png">ü§ï Fall Detected 1 (Image)</option>
        <option value="falldetected.png">ü§ï Fall Detected 2 (Image)</option>
        <option value="elderly-women-fallen.mp4">üßì Elderly Woman Fallen (Video)</option>
        <option value="chaotic-motion-1.png">üí® Chaotic Motion 1 (Image)</option>
        <option value="chaotic-motion-2.png">üí® Chaotic Motion 2 (Image)</option>
        <option value="celebration.mp4">üéâ Celebration Detected (Video)</option>
        <option value="front_door.jpg">üö™ Front Door Camera</option>
        <option value="garage.jpg">üöó Garage Camera</option>
        <option value="kitchen.jpg">üç≥ Kitchen Camera</option>
        <option value="living_room.jpg">üõãÔ∏è Living Room Camera</option>
      </select>
      <button onclick="loadDemo()">View Demo</button>
      <button onclick="analyzeDemo()">Analyze Demo</button>
      <div id="demoPreview"></div>
      <pre id="demoResult"></pre>
    </section>

    <hr>

    <section>
      <h2>üì§ Upload and Analyze Your Own Video</h2>
      <input type="file" id="fileInput" accept="video/*,image/*">
      <button onclick="upload()">Upload</button>
      <pre id="uploadResult"></pre>

      <div style="margin-top:1rem;">
        <label for="vidId">Video ID:</label>
        <input type="text" id="vidId" placeholder="Paste video ID (from upload)">
        <button onclick="analyze()">Analyze</button>
      </div>
      <pre id="analysisResult"></pre>
    </section>

    <hr>

    <section>
      <h2>üßæ Recent Events</h2>
      <button onclick="loadEvents()">Refresh Events</button>
      <pre id="events"></pre>
    </section>

  </main>

  <script>
    const API_BASE = "http://localhost:8000"; // replace with your deployed URL when on Cloud Run

    async function upload() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) {
        alert("Please select a file first");
        return;
      }
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      const resp = await fetch(`${API_BASE}/upload-video`, { method: "POST", body: formData });
      const data = await resp.json();
      document.getElementById("uploadResult").textContent = JSON.stringify(data, null, 2);
      document.getElementById("vidId").value = data.video_id;
    }

    async function analyze() {
      const vid = document.getElementById("vidId").value.trim();
      if (!vid) {
        alert("Please enter a video ID first");
        return;
      }
      const resp = await fetch(`${API_BASE}/analyze/${vid}`, { method: "POST" });
      const data = await resp.json();
      document.getElementById("analysisResult").textContent = JSON.stringify(data, null, 2);
      loadEvents();
    }

    async function loadEvents() {
      const resp = await fetch(`${API_BASE}/events`);
      const data = await resp.json();
      document.getElementById("events").textContent = JSON.stringify(data, null, 2);
    }

    function loadDemo() {
      const sel = document.getElementById('demoSelect').value;
      if (!sel) { alert("Select a demo asset first"); return; }
      const ext = sel.split('.').pop().toLowerCase();
      const demoContainer = document.getElementById("demoPreview");
      demoContainer.innerHTML = "";
      const url = `${API_BASE}/static/assets/${sel}`;
      if (["mp4", "mov", "avi"].includes(ext)) {
        const vid = document.createElement("video");
        vid.src = url;
        vid.controls = true;
        demoContainer.appendChild(vid);
      } else if (["jpg", "jpeg", "png"].includes(ext)) {
        const img = document.createElement("img");
        img.src = url;
        demoContainer.appendChild(img);
      } else {
        demoContainer.textContent = "Unsupported format.";
      }
    }

    async function analyzeDemo() {
      const sel = document.getElementById('demoSelect').value;
      if (!sel) { alert("Select a demo asset first"); return; }
      // Try uploading from static asset (simulate via fetch)
      const resp = await fetch(`${API_BASE}/static/assets/${sel}`);
      const blob = await resp.blob();
      const formData = new FormData();
      formData.append("file", new File([blob], sel));
      const uploadResp = await fetch(`${API_BASE}/upload-video`, { method: "POST", body: formData });
      const uploadData = await uploadResp.json();
      const vid = uploadData.video_id;
      const analyzeResp = await fetch(`${API_BASE}/analyze/${vid}`, { method: "POST" });
      const analyzeData = await analyzeResp.json();
      document.getElementById("demoResult").textContent = JSON.stringify(analyzeData, null, 2);
      loadEvents();
    }
  </script>
</body>
</html>
